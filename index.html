<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Loader</title>
</head>
<body>
<script>
async function loadPage(blobB64, pass, iterations){
    // Convert base64 to ArrayBuffer
    function base64ToBuf(b64){
        const bin = atob(b64);
        const bytes = new Uint8Array(bin.length);
        for(let i=0;i<bin.length;i++) bytes[i]=bin.charCodeAt(i);
        return bytes.buffer;
    }

    // PBKDF2 key derivation
    async function deriveKeyPBKDF2(pass, salt, iterations){
        const base = await crypto.subtle.importKey('raw', new TextEncoder().encode(pass), 'PBKDF2', false, ['deriveKey']);
        return crypto.subtle.deriveKey({name:'PBKDF2', salt, iterations, hash:'SHA-256'}, base, {name:'AES-GCM', length:256}, false, ['decrypt']);
    }

    // AES-GCM decryption
    async function aesDecrypt(blobB64, pass, iterations){
        const buf = new Uint8Array(base64ToBuf(blobB64));
        const salt = buf.slice(0,16).buffer;
        const iv = buf.slice(16,28).buffer;
        const ct = buf.slice(28).buffer;
        const key = await deriveKeyPBKDF2(pass, salt, iterations);
        const pt = await crypto.subtle.decrypt({name:'AES-GCM', iv}, key, ct);
        return new TextDecoder().decode(pt);
    }

    // Decrypt to get the URL
    const url = await aesDecrypt(blobB64, pass, iterations);

    // Fetch the page from that URL
    const response = await fetch(url);
    const html = await response.text();

    // Replace entire page
    document.open();
    document.write(html);
    document.close();
}

// Example usage
const encryptedBlob = "gKqLqq39SscqmPiYto+T/xmQWwqYTZt24r+CmJoyUifTA0BSyvPl4dB0ActWgk18W1zO+MVou2jWtiazJ8M5YfNxHRwf4hAuqznfLWkBd4Q=";
const passphrase = prompt("Enter AES passphrase:");
loadPage(encryptedBlob, passphrase, 300000);
</script>
</body>
</html>
